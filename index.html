import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Progress } from "@/components/ui/progress";


const questions = [
  {
    id: 1,
    text: "å‘¨æœ«ä½ æ›´æ„¿æ„ï¼Ÿ",
    options: [
      { label: "å’Œå¾ˆå¤šäººä¸€èµ·æ´»åŠ¨", type: "E" },
      { label: "ç‹¬å¤„æˆ–åªå’Œå°‘æ•°äºº", type: "I" },
    ],
  },
  {
    id: 2,
    text: "åšå†³å®šæ—¶ä½ æ›´ä¾èµ–ï¼Ÿ",
    options: [
      { label: "é€»è¾‘å’Œæ•°æ®", type: "T" },
      { label: "æ„Ÿå—å’Œä»·å€¼è§‚", type: "F" },
    ],
  },
  {
    id: 3,
    text: "ä½ æ›´å–œæ¬¢ï¼Ÿ",
    options: [
      { label: "è®¡åˆ’æ¸…æ™°å†è¡ŒåŠ¨", type: "J" },
      { label: "è¾¹èµ°è¾¹çœ‹æ›´çµæ´»", type: "P" },
    ],
  },
  {
    id: 4,
    text: "è·å–ä¿¡æ¯æ—¶ä½ æ›´åå‘ï¼Ÿ",
    options: [
      { label: "å…·ä½“äº‹å®ä¸ç»éªŒ", type: "S" },
      { label: "æ¦‚å¿µå’Œå¯èƒ½æ€§", type: "N" },
    ],
  },
  {
    id: 5,
    text: "åœ¨å›¢é˜Ÿä¸­ä½ é€šå¸¸ï¼Ÿ",
    options: [
      { label: "ä¸»åŠ¨å‘è¨€å¸¦èŠ‚å¥", type: "E" },
      { label: "è§‚å¯Ÿåå†è¡¨è¾¾", type: "I" },
    ],
  },
];

function calcResult(answers) {
  const score = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
  answers.forEach((a) => score[a]++);

  const pick = (a, b) => (score[a] >= score[b] ? a : b);

  return (
    pick("E", "I") +
    pick("S", "N") +
    pick("T", "F") +
    pick("J", "P")
  );
}

export default function MBTITestPage() {
  const [step, setStep] = useState(0);
  const [answers, setAnswers] = useState([]);
  const [result, setResult] = useState(null);

  const progress = (step / questions.length) * 100;

  const choose = (type) => {
    const next = [...answers, type];
    setAnswers(next);

    if (step + 1 === questions.length) {
      setResult(calcResult(next));
    }
    setStep(step + 1);
  };

  const reset = () => {
    setStep(0);
    setAnswers([]);
    setResult(null);
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 to-slate-700 p-6">
      <Card className="w-full max-w-xl rounded-2xl shadow-2xl">
        <CardContent className="p-8">
          <div className="mb-6">
            <h1 className="text-3xl font-bold mb-2">MBTI æé€Ÿäººæ ¼æµ‹è¯•</h1>
            <p className="text-sm opacity-70">5é¢˜ Â· é«˜è´¨æ„ŸåŠ¨æ•ˆ Â· ç§’å‡ºç»“æœ</p>
          </div>

          {!result && (
            <div className="mb-6">
              <Progress value={progress} />
              <p className="text-xs mt-2 opacity-60">
                è¿›åº¦ {step}/{questions.length}
              </p>
            </div>
          )}

          <AnimatePresence mode="wait">
            {!result ? (
              <motion.div
                key={step}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -20 }}
                transition={{ duration: 0.3 }}
              >
                {questions[step] && (
                  <div>
                    <h2 className="text-xl font-semibold mb-6">
                      {questions[step].text}
                    </h2>

                    <div className="grid gap-4">
                      {questions[step].options.map((opt) => (
                        <Button
                          key={opt.label}
                          className="h-14 text-base rounded-xl"
                          variant="outline"
                          onClick={() => choose(opt.type)}
                        >
                          {opt.label}
                        </Button>
                      ))}
                    </div>
                  </div>
                )}
              </motion.div>
            ) : (
              <motion.div
                key="result"
                initial={{ opacity: 0, scale: 0.9 }}
                animate={{ opacity: 1, scale: 1 }}
                transition={{ duration: 0.4 }}
                className="text-center"
              >
                <div className="text-sm opacity-60 mb-2">ä½ çš„MBTIç±»å‹</div>
                <div className="text-5xl font-extrabold mb-4 tracking-widest">
                  {result}
                </div>
                <p className="opacity-70 mb-6">
                  è¿™æ˜¯ä¸€ä¸ªå¿«é€Ÿç‰ˆæµ‹è¯•ç»“æœï¼Œä»…ä¾›å¨±ä¹ï¼Œä½†å·²ç»å¾ˆæœ‰å‚è€ƒå‘³é“ ğŸ˜
                </p>

                <Button onClick={reset} className="rounded-xl px-8">
                  å†æµ‹ä¸€æ¬¡
                </Button>
              </motion.div>
            )}
          </AnimatePresence>
        </CardContent>
      </Card>
    </div>
  );
}
